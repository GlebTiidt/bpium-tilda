# Журнал процесса интеграции

## 2025-01-09

- Получена исходная документация от пользователя по Bpium (интеграции и API) и Tilda (API и экспорт страниц).
- Задача этапа: сохранить документацию в Markdown-файлах в папке `docs` и завести журнал процесса.
- Выполнено: созданы `docs/bpium.md` и `docs/tilda.md` с конспектами ключевых разделов из присланных материалов.
- Сложности: на текущем этапе отсутствуют — задача заключалась в структурированном переносе информации без необходимости уточнения дополнительных данных.
- Дополнительно: конспектирована архитектура и требования Bpium (структура сервисов, железо, установка как служба, Docker, мультидомен) в `docs/bpium.md` для дальнейшего проектирования интеграции.
- Получен и добавлен детальный справочник по API данных Bpium (каталоги, записи, связи, истории, файлы, отделы, виды, сообщения) в `docs/bpium.md` для подготовки к проектированию обмена с Tilda.
- Настроен локальный файл окружения `.env.local` с доступами к тестовой системе Bpium (домен, e-mail, пароль) и добавлен `.gitignore`, чтобы исключить секреты из репозитория.
- Реализован скрипт `scripts/update_course_title.py`, который получает `record.title` из каталога 16 (Bpium) и заменяет плейсхолдер `{{course_title}}` в экспортированном HTML Tilda; создан пример блока `tilda/homepage-section.html` для локальной проверки и описана инструкция в `docs/tilda.md`.
- Получены ключи Tilda API; сохранены локально в `.env.local` как `TILDA_PUBLIC_KEY` и `TILDA_SECRET_KEY` (без коммита в репозиторий) для дальнейшей выгрузки страниц.
- Зафиксированы `TILDA_PAGE_ID=92671716` и `TILDA_PROJECT_ID=11370897` в `.env.local` для дальнейших запросов `getpagefullexport`.
- Создан серверный слой-посредник на FastAPI (`app/main.py`) с кэшированием и endpoint `/api/courses/latest`, который читает данные каталога 16 через Bpium API и готов к отдаче их фронту Tilda.
- Синхронизированы идентификаторы полей каталога 16 (см. `FIELD_MAP`), добавлены функции приведения типов в `app/bpium.py` и зафиксирован пример JSON ответа `/api/courses/latest` в `docs/tilda.md` для фронтенд-интеграции.
- Включён CORS (через `fastapi.middleware.cors`) с настройкой `CORS_ALLOW_ORIGINS` из `.env.local`, чтобы фронт на домене Tilda мог напрямую обращаться к `/api/courses/latest`.
- Добавлен `CORS_ALLOW_ORIGINS=https://mpa-sandbox.tilda.ws` в `.env.local`, чтобы страница проекта на Tilda могла вызывать API через публичный ngrok-адрес.
